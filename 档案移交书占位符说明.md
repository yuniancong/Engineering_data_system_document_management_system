# 档案移交书占位符完整说明

## 当前模板中的占位符

根据您上传的模板，当前已使用的占位符：

| 占位符 | 说明 | 数据来源 | 示例值 |
|--------|------|----------|--------|
| `{{title}}` | 工程名称 | coverData.title | 某某工程项目 |
| `{{unit}}` | 移交单位 | coverData.unit | 某某建设公司 |
| `{{totalVolumes}}` | 案卷总数 | coverData.totalVolumes | 3 |

## 建议添加的占位符

### 基础信息
| 占位符 | 说明 | 数据来源 | 示例值 |
|--------|------|----------|--------|
| `{{date}}` | 移交日期 | 自动生成当天 | 2024-11-16 |
| `{{archiveNo}}` | 档号 | coverData.archiveNo | 2024-001 |
| `{{retentionPeriod}}` | 保管期限 | coverData.retentionPeriod | 永久 |

### 材料统计（重要！）

#### 档案数量统计
| 占位符 | 说明 | 如何计算 | 示例值 |
|--------|------|----------|--------|
| `{{textVolumes}}` | 文字材料卷数 | 统计所有文字材料的案卷数 | 2 |
| `{{drawingVolumes}}` | 图样材料卷数 | 统计所有图样材料的案卷数 | 1 |
| `{{otherVolumes}}` | 其他材料卷数 | 统计其他类型材料的案卷数 | 0 |

#### 页数/张数统计
| 占位符 | 说明 | 如何计算 | 示例值 |
|--------|------|----------|--------|
| `{{totalPages}}` | 文件总页数 | 所有案卷的总页数 | 450 |
| `{{textPages}}` | 文字材料总页数 | 所有文字材料页数 | 350 |
| `{{drawingPages}}` | 图样材料总张数 | 所有图样材料张数 | 95 |
| `{{photoCount}}` | 照片总张数 | 所有照片张数 | 5 |
| `{{otherCount}}` | 其他材料总数 | 其他材料数量 | 0 |

#### 文件数量统计
| 占位符 | 说明 | 如何计算 | 示例值 |
|--------|------|----------|--------|
| `{{totalFiles}}` | 文件总份数 | 所有案卷的文件数 | 150 |
| `{{textFiles}}` | 文字材料份数 | 文字材料文件数 | 120 |
| `{{drawingFiles}}` | 图样材料份数 | 图样材料文件数 | 28 |
| `{{photoFiles}}` | 照片份数 | 照片文件数 | 2 |

### 移交信息
| 占位符 | 说明 | 用户填写 | 示例值 |
|--------|------|----------|--------|
| `{{note}}` | 移交说明 | recordData.note 或专门字段 | 本工程档案资料已按GB 50328-2014标准整理完毕 |
| `{{transferPerson}}` | 移交人 | 用户填写 | 张三 |
| `{{transferDate}}` | 移交日期 | 用户填写或自动 | 2024-11-16 |
| `{{receivePerson}}` | 接收人 | 用户填写 | 李四 |
| `{{receiveDate}}` | 接收日期 | 用户填写 | 2024-11-17 |

## 推荐的移交书模板内容

```
档案移交书

工程名称：{{title}}
移交单位：{{unit}}
档号：{{archiveNo}}
移交日期：{{date}}

一、档案概况

本次移交档案共 {{totalVolumes}} 卷，具体如下：

1. 案卷数量
   - 文字材料：{{textVolumes}} 卷
   - 图样材料：{{drawingVolumes}} 卷
   - 其他材料：{{otherVolumes}} 卷

2. 文件数量
   - 文件总数：{{totalFiles}} 份
   - 文字材料：{{textFiles}} 份
   - 图样材料：{{drawingFiles}} 份
   - 照片：{{photoFiles}} 张

3. 页数/张数统计
   - 总页数：{{totalPages}} 页
   - 文字材料：{{textPages}} 页
   - 图样材料：{{drawingPages}} 张
   - 照片：{{photoCount}} 张

二、移交说明

{{note}}

三、移交确认

保管期限：{{retentionPeriod}}
密级：{{secretLevel}}

移交人：{{transferPerson}}        日期：{{transferDate}}
接收人：{{receivePerson}}        日期：{{receiveDate}}

（移交单位盖章）              （接收单位盖章）
```

## 数据填充说明

### 自动计算的数据
以下数据由系统自动计算，无需手动填写：

1. **{{totalPages}}** - 汇总所有案卷的总页数
2. **{{textPages}}** - 汇总所有文字材料页数
3. **{{drawingPages}}** - 汇总所有图样材料张数
4. **{{photoCount}}** - 汇总所有照片张数
5. **{{totalFiles}}** - 统计所有卷内目录的文件数
6. **{{textVolumes}}** - 统计文字材料类型的案卷数
7. **{{drawingVolumes}}** - 统计图样材料类型的案卷数

### 需要手动填写的数据

在即将创建的"移交书"专门页面中填写：

1. **移交说明（{{note}}）**
   - 默认：本工程档案资料已按GB 50328-2014标准整理完毕，现移交存档。
   - 可以自定义修改

2. **移交人信息**
   - 移交人姓名（{{transferPerson}}）
   - 移交日期（{{transferDate}}）

3. **接收人信息**
   - 接收人姓名（{{receivePerson}}）
   - 接收日期（{{receiveDate}}）

## 如何在模板中添加占位符

### 方法一：直接编辑Word模板

1. 打开 `templates/附件3-移交书.docx`
2. 将上面"推荐的移交书模板内容"复制粘贴到Word中
3. 调整格式、字体、间距等
4. 保存文件

### 方法二：选择性添加

只添加您需要的占位符，例如最简化版本：

```
档案移交书

工程名称：{{title}}
移交单位：{{unit}}
移交日期：{{date}}

本次移交档案共 {{totalVolumes}} 卷，文件总数 {{totalFiles}} 份，共 {{totalPages}} 页。

移交说明：{{note}}

移交人：                    日期：
接收人：                    日期：
```

## 数据计算逻辑

### 卷数统计逻辑

```javascript
// 根据案卷的主要材料类型分类
- 文字材料卷：案卷中文字材料页数 > 图样材料页数
- 图样材料卷：案卷中图样材料页数 > 文字材料页数
- 其他材料卷：两者都为0或特殊标记
```

### 文件数统计逻辑

```javascript
// 统计所有案卷的卷内目录条目数
totalFiles = volume1.directory.length + volume2.directory.length + ...
```

### 材料分类逻辑

根据卷内目录中的文件题名、文件编号、备注等关键词自动分类：

```javascript
- 文字材料：默认类型，或包含"文件"、"报告"等关键词
- 图样材料：包含"图"、"图纸"、"设计图"、"施工图"等关键词
- 照片：包含"照片"、"相片"、"图片"等关键词
```

## 使用示例

### 场景：三个案卷的工程

**案卷1（设计文件卷）**：
- 卷内目录：50份文件
- 文字材料：200页
- 图样材料：30张
- 照片：0张

**案卷2（施工文件卷）**：
- 卷内目录：80份文件
- 文字材料：300页
- 图样材料：50张
- 照片：5张

**案卷3（竣工文件卷）**：
- 卷内目录：20份文件
- 文字材料：100页
- 图样材料：15张
- 照片：0张

### 自动计算结果

```
{{totalVolumes}} = 3
{{totalFiles}} = 150
{{totalPages}} = 600 + 95 = 695  (文字+图样)

{{textVolumes}} = 3  (所有卷都以文字为主)
{{drawingVolumes}} = 0
{{otherVolumes}} = 0

{{textPages}} = 600
{{drawingPages}} = 95
{{photoCount}} = 5

{{textFiles}} = 约130  (根据关键词分类)
{{drawingFiles}} = 约15
{{photoFiles}} = 5
```

## 注意事项

1. **占位符格式**：必须使用双花括号 `{{}}`，区分大小写
2. **数据自动计算**：大部分数据由系统自动汇总，确保先填写完所有案卷
3. **手动填写字段**：移交人、接收人等信息需要在专门页面中填写
4. **模板灵活性**：可以根据实际需求选择使用哪些占位符

## 常见问题

### Q: 如何区分文字材料卷和图样材料卷？

**A**: 系统根据每个案卷的备考表数据判断：
- 如果文字材料页数 > 图样材料页数，归类为文字材料卷
- 如果图样材料页数 > 文字材料页数，归类为图样材料卷
- 您也可以在案卷属性中手动指定类型

### Q: 如果不需要这么详细的统计怎么办？

**A**: 可以使用简化版模板，只包含必需的占位符：
- {{title}}、{{unit}}、{{totalVolumes}}、{{totalPages}}、{{note}}

### Q: 数据统计不准确怎么办？

**A**:
1. 检查各案卷的备考表数据是否正确
2. 使用调试工具查看数据状态
3. 确认所有案卷都已保存
4. 在移交书页面可以手动调整统计数据

---

**更新日期**：2024-11-16
**版本**：v1.0

建议：先使用简化版模板测试，确认基本功能正常后，再逐步添加详细的统计信息。
