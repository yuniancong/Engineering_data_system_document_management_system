# 工程资料归档管理系统

基于 GB 50328-2014《建设工程文件归档规范》的自动化归档组件系统

## 项目简介

这是一个专门用于工程资料归档的 Web 应用，帮助您高效地完成卷内目录、卷内备考表、案卷封面和案卷目录的填写与管理。系统支持两种输入模式，能够大幅提升归档工作效率。

## 核心功能

### 1. 卷内目录输入

**7列标准表格**：
- 序号（自动生成，只读）
- 文件编号（发文号/图号/设备代号）
- 责任者（形成单位或个人）
- 文件题名
- 日期（YYYY-MM-DD格式）
- 页次（支持单页、范围、多段，如：5-10,15-20）
- 备注

**序号自动管理**：
- 序号从1开始自动递增
- 添加或删除行时自动重新编号
- 无需手动输入，确保序号连续

**两种输入模式**：

#### 模式一：常规复制粘贴模式
- 直接在表格单元格中输入或粘贴内容
- 支持从Excel等软件批量复制数据
- 可手动逐个填写

#### 模式二：点按模式（剪贴板快捷粘贴）
- 启用方式：勾选"启用点按模式"复选框
- 操作流程：
  1. 先复制需要填写的内容到剪贴板
  2. 点击对应列的按钮（如"📋 文件题名"）
  3. 系统自动将剪贴板内容粘贴到该列的空白单元格
  4. 支持多行数据批量粘贴
- **权限优化**：首次启用点按模式时请求剪贴板权限，之后不再重复提示

### 2. 自动生成功能

#### 卷内备考表
自动统计和生成：
- 总页数（根据页次字段自动计算）
- 文字材料页数
- 图样材料页数
- 照片张数
- 支持手动调整和添加说明
- 立卷人和审核人签字区

**智能分类逻辑**：
系统根据文件题名、文件编号、备注等字段智能识别文件类型：
- 包含"照片"、"图片"等关键词 → 照片
- 包含"图纸"、"设计图"、"施工图"等关键词 → 图样
- 其他 → 文字材料

#### 案卷封面
自动提取和填充：
- 档号（可手动输入）
- 案卷题名（智能提取共同前缀或第一个文件题名）
- 编制单位（最常出现的责任者）
- 起止日期（从卷内目录日期字段提取）
- 密级和保管期限（可手动选择）
- 案卷总量和当前卷号

#### 案卷目录
汇总多卷数据：
- 案卷号
- 案卷题名
- 卷内数量（文字/图纸/其他）
- 编制单位
- 编制日期
- 保管期限
- 密级
- 备注

### 3. 同步联动功能

**手动触发同步**：
- 卷内备考表：点击"从卷内目录同步"按钮
- 案卷封面：点击"从卷内目录同步"按钮
- 案卷目录：点击"从当前卷同步"按钮
- 一键生成：点击"自动生成其他表格"按钮，同时生成所有表格

**支持手动编辑**：
- 所有自动生成的内容都可以手动修改
- 修改后的内容会被保留，不会在下次同步时丢失
- 您可以选择是否重新同步以覆盖修改

### 4. 数据管理

**自动保存**：
- 系统每30秒自动保存数据到浏览器本地存储
- 关闭页面前自动保存
- 快捷键 Ctrl+S 手动保存

**数据操作**：
- 保存数据：手动保存到本地存储
- 加载数据：从本地存储加载之前保存的数据
- 导出数据：导出为Excel文件（.xlsx），包含4个工作表（卷内目录、卷内备考表、案卷封面、案卷目录）
- 清空数据：清除所有数据（需确认）

## 使用指南

### 基本工作流程

1. **填写卷内目录**
   - 点击"添加行"按钮添加新行
   - 选择输入模式（常规或点按模式）
   - 填写7列信息
   - 勾选不需要的行，点击"删除选中行"

2. **自动生成其他表格**
   - 点击"自动生成其他表格"按钮
   - 或者分别在各个表格页面点击"同步"按钮

3. **检查和修改**
   - 切换到各个标签页查看生成的内容
   - 手动修改不准确的信息
   - 完善立卷人、审核人等签字信息

4. **保存和导出**
   - 系统会自动保存，也可手动保存
   - 需要备份时点击"导出数据"

### 点按模式详细说明

点按模式特别适合大批量数据录入：

**单列批量录入场景**：
```
假设您有20个文件题名需要录入：
1. 从Word/Excel中复制所有文件题名（多行）
2. 勾选"启用点按模式"
3. 点击"📋 文件题名"按钮
4. 系统自动将20个题名分别填入20行
```

**多列交替录入场景**：
```
1. 复制5个文件编号 → 点击"📋 文件编号"
2. 复制5个责任者 → 点击"📋 责任者"
3. 复制5个文件题名 → 点击"📋 文件题名"
4. 继续下一批...
```

### 页次填写规范

支持多种格式：
- 单页：`5`
- 范围：`5-10`（表示第5页到第10页）
- 多段：`5-10,15-20`（表示第5-10页和第15-20页）

系统会自动计算总页数和页码范围。

### 日期填写规范

符合 GB 50328-2014 标准格式：
- 标准格式：`YYYY-MM-DD`（如：2024-11-16）
- 使用日期选择器可自动格式化

### 快捷键

- **Ctrl+S**：保存数据
- **Ctrl+G**：自动生成所有表格

## 技术规范

### 符合标准

- GB 50328-2014《建设工程文件归档规范》
- 表格样式参照标准附录C、D、E、G

### 字段说明

#### 卷内目录
- 序号：以一份文件为单位，从1开始编号
- 责任者：多个责任者时选两个主要的
- 文件编号：发文号、图号或设备代号
- 日期：四位年份+两位月日
- 页次：文件在卷内的起始页号

#### 页号编制规则
- 每卷独立编号，从"1"开始
- 单面书写：右下角
- 双面书写：正面右下角，背面左下角
- 注意：案卷封面、卷内目录、卷内备考表不编页号

#### 文件排列顺序
标准顺序：
1. 案卷封面
2. 卷内目录
3. 正文文件（文字材料在前，图纸在后）
4. 卷内备考表

## 浏览器兼容性

- Chrome 85+（推荐）
- Firefox 78+
- Edge 85+
- Safari 14+

**注意**：点按模式需要浏览器支持 Clipboard API，首次使用时需要授权访问剪贴板。

## 数据安全

- 所有数据存储在浏览器本地（LocalStorage）
- 不会上传到任何服务器
- 建议定期导出数据进行备份
- 清除浏览器数据会导致本地数据丢失

## 常见问题

### 1. 点按模式无法读取剪贴板？
- 首次启用点按模式时需要授权浏览器访问剪贴板权限
- 授权后不会再次提示，系统会记住权限状态
- 某些浏览器（特别是Safari）可能不支持，请使用Chrome

### 2. 序号可以手动修改吗？
- 序号是自动生成的，不可手动修改
- 添加、删除行时会自动重新编号
- 确保序号始终从1开始连续递增

### 3. 导出的Excel文件在哪里？
- 点击"导出数据"按钮后，Excel文件会自动下载到浏览器默认下载目录
- 文件名格式：工程资料归档_YYYY-MM-DD.xlsx
- 包含4个工作表，分别是卷内目录、卷内备考表、案卷封面、案卷目录

### 4. 数据丢失了怎么办？
- 检查浏览器本地存储是否被清除
- 系统每30秒自动保存，正常情况下不会丢失数据
- 建议定期导出Excel文件备份

### 5. 如何修改自动生成的内容？
- 所有表格都支持手动编辑
- 修改后可选择是否重新同步（会覆盖修改）

### 6. 智能分类不准确怎么办？
- 在卷内备考表页面手动调整文字/图样/照片的页数
- 在文件题名或备注中添加关键词（如"照片"、"图纸"）可以帮助识别

### 7. 多个工程如何管理？
- 每完成一个工程，导出Excel文件备份
- 清空数据后开始新工程
- 如需重新编辑之前的工程，从Excel导入数据（暂不支持，建议保留浏览器数据）

## 文件结构

```
Engineering_data_system_document_management_system/
├── index.html           # 主界面
├── styles.css          # 样式文件
├── app.js              # 主应用逻辑
├── data-manager.js     # 数据管理层
├── README.md           # 使用说明
├── 参照/
│   ├── 规程总结性说明.txt
│   └── 资料表格形式参照/
│       ├── 附录C 卷内目录式样.png
│       ├── 附录D 卷内备考表式样.png
│       ├── 附录E 案卷封面式样.png
│       ├── 附录G 案卷目录式样.png
│       └── 引用标准名录.png
└── 项目创建需求.txt
```

## 开发说明

### 技术栈
- 纯HTML + CSS + JavaScript
- 无需服务器，可直接在浏览器中运行
- 使用 LocalStorage 进行数据持久化

### 扩展开发
如需扩展功能，主要修改以下文件：
- `data-manager.js`：数据逻辑和计算规则
- `app.js`：UI交互和事件处理
- `styles.css`：界面样式

## 更新日志

### v1.1.0 (2024-11-16)
- **序号自动管理**：序号改为自动生成，添加/删除行时自动重新编号
- **剪贴板权限优化**：首次启用点按模式时请求权限，之后不再重复提示
- **Excel导出功能**：导出格式从JSON改为Excel (.xlsx)，包含4个工作表
- 优化用户体验，减少手动操作

### v1.0.0 (2024-11-16)
- 初始版本发布
- 实现卷内目录、卷内备考表、案卷封面、案卷目录四个模块
- 支持常规和点按两种输入模式
- 实现自动生成和同步联动功能
- 支持数据持久化和导出

## 许可证

本项目遵循 GB 50328-2014 标准开发，仅供工程资料归档使用。

## 联系方式

如有问题或建议，请通过项目仓库提交Issue。
