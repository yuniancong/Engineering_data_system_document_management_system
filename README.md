# 工程资料归档管理系统

基于 GB 50328-2014《建设工程文件归档规范》的自动化归档组件系统

## 项目简介

这是一个专门用于工程资料归档的 Web 应用，帮助您高效地完成卷内目录、卷内备考表、案卷封面和案卷目录的填写与管理。系统支持两种输入模式，能够大幅提升归档工作效率。

## 核心功能

### 1. 卷内目录输入

**7列标准表格**：
- 序号（自动生成，只读）
- 文件编号（发文号/图号/设备代号）
- 责任者（形成单位或个人）
- 文件题名
- 日期（YYYY-MM-DD格式）
- 页次（支持单页、范围、多段，如：5-10,15-20）
- 备注

**序号自动管理**：
- 序号从1开始自动递增
- 添加或删除行时自动重新编号
- 无需手动输入，确保序号连续

**三种输入模式**：

#### 模式一：常规输入模式
- 直接在表格单元格中输入内容
- 支持单元格级别的复制粘贴
- 适合少量数据手动填写

#### 模式二：批量粘贴整行
**方式一：默认顺序粘贴**
- 点击"📋 粘贴整行"按钮
- 支持从Excel复制整行（包含多列）直接粘贴
- 自动识别Tab分隔的多列数据
- 固定列顺序：文件编号、责任者、文件题名、日期、页次、备注
- 支持一次粘贴多行数据
- 适合标准格式数据

**方式二：自定义粘贴（推荐）** ⭐
- 点击"📋 自定义粘贴"按钮
- 弹出对话框，可自由选择每一列的映射关系
- 支持跳过不需要的列（选择"不导入"）
- 提供预设方案：默认顺序、仅题名、题名+日期
- **灵活性最强，适合各种格式的数据**

#### 模式三：列粘贴模式
- 启用方式：勾选"启用列粘贴模式"复选框
- 表格上方显示列按钮：文件编号、责任者、文件题名、日期、页次、备注
- 操作流程：
  1. 复制某一列的多个数据到剪贴板
  2. 点击对应的列按钮
  3. 系统自动将数据填充到该列的空白单元格
- 适合单列批量填写
- **权限优化**：首次使用时请求剪贴板权限，之后永久记住，不再重复提示

### 2. 自动生成功能

#### 卷内备考表
自动统计和生成：
- 总页数（根据页次字段自动计算）
- 文字材料页数
- 图样材料页数
- 照片张数
- 支持手动调整和添加说明
- 立卷人和审核人签字区

**智能分类逻辑**：
系统根据文件题名、文件编号、备注等字段智能识别文件类型：
- 包含"照片"、"图片"等关键词 → 照片
- 包含"图纸"、"设计图"、"施工图"等关键词 → 图样
- 其他 → 文字材料

#### 案卷封面
自动提取和填充：
- 档号（可手动输入）
- 案卷题名（智能提取共同前缀或第一个文件题名）
- 编制单位（最常出现的责任者）
- 起止日期（从卷内目录日期字段提取）
- 密级和保管期限（可手动选择）
- 案卷总量和当前卷号

#### 案卷目录
汇总多卷数据：
- 案卷号
- 案卷题名
- 卷内数量（文字/图纸/其他）
- 编制单位
- 编制日期
- 保管期限
- 密级
- 备注

### 3. 同步联动功能

**手动触发同步**：
- 卷内备考表：点击"从卷内目录同步"按钮
- 案卷封面：点击"从卷内目录同步"按钮
- 案卷目录：点击"从当前卷同步"按钮
- 一键生成：点击"自动生成其他表格"按钮，同时生成所有表格

**支持手动编辑**：
- 所有自动生成的内容都可以手动修改
- 修改后的内容会被保留，不会在下次同步时丢失
- 您可以选择是否重新同步以覆盖修改

### 4. 数据管理

**自动保存**：
- 系统每30秒自动保存数据到浏览器本地存储
- 关闭页面前自动保存
- 快捷键 Ctrl+S 手动保存

**数据操作**：
- 保存数据：手动保存到本地存储
- 加载数据：从本地存储加载之前保存的数据
- 导出数据：
  - Excel格式：包含4个工作表（卷内目录、卷内备考表、案卷封面、案卷目录）
  - Word模板格式：基于标准模板自动填充数据（规划中）
- 清空数据：清除所有数据（需确认）

## 使用指南

### 基本工作流程

#### 推荐流程（批量粘贴整行）

1. **在Excel中准备数据**
   - 按顺序排列：文件编号、责任者、文件题名、日期、页次、备注
   - 可以包含多行数据
   - 复制需要的行（Ctrl+C）

2. **粘贴到系统**
   - 点击"📋 粘贴整行"按钮
   - 系统自动创建新行并填充数据
   - 序号自动生成

3. **自动生成其他表格**
   - 点击"自动生成其他表格"按钮
   - 或者分别在各个表格页面点击"同步"按钮

4. **检查和修改**
   - 切换到各个标签页查看生成的内容
   - 手动修改不准确的信息
   - 完善立卷人、审核人等签字信息

5. **保存和导出**
   - 系统会自动保存，也可手动保存
   - 点击"导出数据"导出Excel文件备份

#### 其他工作流程

**常规输入模式**：
- 点击"添加行"按钮添加新行
- 在表格单元格中直接输入
- 适合少量数据

**列粘贴模式**：
- 勾选"启用列粘贴模式"
- 复制某一列的多个数据
- 点击对应的列按钮粘贴
- 适合单列批量填写

### 批量粘贴整行详细说明

#### 方式一：默认顺序粘贴

适合数据列顺序与系统一致的情况：

```
1. 在Excel中选择多行数据（列顺序：文件编号、责任者、文件题名、日期、页次、备注）
2. 复制（Ctrl+C）
3. 点击"📋 粘贴整行"按钮
4. 系统自动创建行并填充
```

**列顺序规则（固定）**：
- 第1列 → 文件编号
- 第2列 → 责任者
- 第3列 → 文件题名
- 第4列 → 日期
- 第5列 → 页次
- 第6列 → 备注

#### 方式二：自定义粘贴（推荐）⭐

适合任意格式的数据，灵活性最强：

```
1. 在Excel中复制数据（任意列顺序、任意列数）
2. 点击"📋 自定义粘贴"按钮
3. 在弹出的对话框中设置列映射：
   - 选择剪贴板第1列对应系统的哪个字段
   - 选择剪贴板第2列对应系统的哪个字段
   - ...
   - 不需要的列选择"不导入"
4. 可以使用预设方案快速设置
5. 点击"确定粘贴"
```

**使用场景示例**：

**场景1：只有文件题名和日期**
```
Excel数据：
施工组织设计    2024-01-15
开工报告        2024-01-16

操作：
1. 复制数据
2. 点击"📋 自定义粘贴"
3. 点击"预设：题名+日期"
4. 确定粘贴
```

**场景2：列顺序与系统不同**
```
Excel数据（顺序：日期、题名、责任者）：
2024-01-15    施工组织设计    建设单位
2024-01-16    开工报告        监理单位

操作：
1. 复制数据
2. 点击"📋 自定义粘贴"
3. 手动设置映射：
   - 剪贴板第1列 → 日期
   - 剪贴板第2列 → 文件题名
   - 剪贴板第3列 → 责任者
   - 其他列选择"不导入"
4. 确定粘贴
```

**场景3：包含不需要的列**
```
Excel数据（包含序号列，不需要导入）：
1    施工组织设计    建设单位    2024-01-15
2    开工报告        监理单位    2024-01-16

操作：
1. 复制数据（包括序号列）
2. 点击"📋 自定义粘贴"
3. 设置映射：
   - 剪贴板第1列 → 不导入（跳过序号）
   - 剪贴板第2列 → 文件题名
   - 剪贴板第3列 → 责任者
   - 剪贴板第4列 → 日期
4. 确定粘贴
```

### 列粘贴模式详细说明

适合单列批量填写：

**单列批量录入场景**：
```
假设您有20个文件题名需要录入：
1. 从Word/Excel中复制所有文件题名（多行）
2. 勾选"启用列粘贴模式"
3. 点击"文件题名"按钮
4. 系统自动将20个题名分别填入该列的空白单元格
```

### 页次填写规范

支持多种格式：
- 单页：`5`
- 范围：`5-10`（表示第5页到第10页）
- 多段：`5-10,15-20`（表示第5-10页和第15-20页）

系统会自动计算总页数和页码范围。

### 日期填写规范

符合 GB 50328-2014 标准格式：
- 标准格式：`YYYY-MM-DD`（如：2024-11-16）
- 使用日期选择器可自动格式化

### 快捷键

- **Ctrl+S**：保存数据
- **Ctrl+G**：自动生成所有表格

## 技术规范

### 符合标准

- GB 50328-2014《建设工程文件归档规范》
- 表格样式参照标准附录C、D、E、G

### 字段说明

#### 卷内目录
- 序号：以一份文件为单位，从1开始编号
- 责任者：多个责任者时选两个主要的
- 文件编号：发文号、图号或设备代号
- 日期：四位年份+两位月日
- 页次：文件在卷内的起始页号

#### 页号编制规则
- 每卷独立编号，从"1"开始
- 单面书写：右下角
- 双面书写：正面右下角，背面左下角
- 注意：案卷封面、卷内目录、卷内备考表不编页号

#### 文件排列顺序
标准顺序：
1. 案卷封面
2. 卷内目录
3. 正文文件（文字材料在前，图纸在后）
4. 卷内备考表

## 浏览器兼容性

- Chrome 85+（推荐）
- Firefox 78+
- Edge 85+
- Safari 14+

**注意**：点按模式需要浏览器支持 Clipboard API，首次使用时需要授权访问剪贴板。

## 数据安全

- 所有数据存储在浏览器本地（LocalStorage）
- 不会上传到任何服务器
- 建议定期导出数据进行备份
- 清除浏览器数据会导致本地数据丢失

## 常见问题

### 1. 剪贴板功能无法使用？
- 首次使用粘贴功能时需要授权浏览器访问剪贴板权限
- 授权后系统会**永久记住**权限状态，不会再重复请求
- 权限状态保存在浏览器本地存储中
- 如果清除浏览器数据，需要重新授权
- 某些浏览器（特别是Safari）可能不支持，**推荐使用Chrome**

### 2. 序号可以手动修改吗？
- 序号是自动生成的，不可手动修改
- 添加、删除行时会自动重新编号
- 确保序号始终从1开始连续递增

### 3. 导出的Excel文件在哪里？
- 点击"导出数据"按钮后，Excel文件会自动下载到浏览器默认下载目录
- 文件名格式：工程资料归档_YYYY-MM-DD.xlsx
- 包含4个工作表，分别是卷内目录、卷内备考表、案卷封面、案卷目录

### 4. 数据丢失了怎么办？
- 检查浏览器本地存储是否被清除
- 系统每30秒自动保存，正常情况下不会丢失数据
- 建议定期导出Excel文件备份

### 5. 如何修改自动生成的内容？
- 所有表格都支持手动编辑
- 修改后可选择是否重新同步（会覆盖修改）

### 6. 智能分类不准确怎么办？
- 在卷内备考表页面手动调整文字/图样/照片的页数
- 在文件题名或备注中添加关键词（如"照片"、"图纸"）可以帮助识别

### 7. 批量粘贴整行时列顺序不对怎么办？
- **推荐使用"📋 自定义粘贴"功能**，可自由映射列
- 或者在Excel中调整列顺序以匹配系统固定顺序
- 自定义粘贴支持跳过不需要的列

### 8. 粘贴时出现乱码或格式错误？
- 确保从Excel复制时使用Ctrl+C（不是剪切）
- 避免复制包含特殊格式的单元格（如公式、合并单元格）
- 如果数据来自Word或PDF，建议先粘贴到Excel整理后再复制

### 9. 多个工程如何管理？
- 每完成一个工程，导出Excel文件备份
- 清空数据后开始新工程
- 如需重新编辑之前的工程，从Excel导入数据（暂不支持，建议保留浏览器数据）

## 文件结构

```
Engineering_data_system_document_management_system/
├── index.html           # 主界面
├── styles.css          # 样式文件
├── app.js              # 主应用逻辑
├── data-manager.js     # 数据管理层
├── README.md           # 使用说明
├── 参照/
│   ├── 规程总结性说明.txt
│   └── 资料表格形式参照/
│       ├── 附录C 卷内目录式样.png
│       ├── 附录D 卷内备考表式样.png
│       ├── 附录E 案卷封面式样.png
│       ├── 附录G 案卷目录式样.png
│       └── 引用标准名录.png
└── 项目创建需求.txt
```

## 开发说明

### 技术栈
- 纯HTML + CSS + JavaScript
- 无需服务器，可直接在浏览器中运行
- 使用 LocalStorage 进行数据持久化

### 扩展开发
如需扩展功能，主要修改以下文件：
- `data-manager.js`：数据逻辑和计算规则
- `app.js`：UI交互和事件处理
- `styles.css`：界面样式

## 更新日志

### v1.3.0 (2024-11-16)
- **自定义粘贴功能**：新增列映射对话框，支持灵活配置粘贴规则
- **预设方案**：提供默认顺序、仅题名、题名+日期三种预设
- **列跳过功能**：可选择不导入某些列
- **解决列顺序问题**：不再受限于固定列顺序
- 适配各种格式的Excel数据，大幅提升灵活性

### v1.2.0 (2024-11-16)
- **批量粘贴整行功能**：支持从Excel复制整行（多列）数据，一键粘贴
- **优化列粘贴模式**：按钮移到表格上方，操作更便捷
- **剪贴板权限永久记住**：使用localStorage保存权限状态，不再重复请求
- **修复粘贴逻辑**：优化空行查找机制，避免重复创建行
- 界面优化，提升批量录入效率

### v1.1.0 (2024-11-16)
- **序号自动管理**：序号改为自动生成，添加/删除行时自动重新编号
- **剪贴板权限优化**：首次启用点按模式时请求权限，之后不再重复提示
- **Excel导出功能**：导出格式从JSON改为Excel (.xlsx)，包含4个工作表
- 优化用户体验，减少手动操作

### v1.0.0 (2024-11-16)
- 初始版本发布
- 实现卷内目录、卷内备考表、案卷封面、案卷目录四个模块
- 支持常规和点按两种输入模式
- 实现自动生成和同步联动功能
- 支持数据持久化和导出

## 许可证

本项目遵循 GB 50328-2014 标准开发，仅供工程资料归档使用。

## 联系方式

如有问题或建议，请通过项目仓库提交Issue。
