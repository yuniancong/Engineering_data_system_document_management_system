# 立即修复导出问题指南

## 🚨 当前问题

您遇到的问题：
1. ✅ **卷内目录**导出正常（有数据）
2. ❌ **备考表**导出为空（无数据）
3. ❌ **案卷封面**导出为空（无数据）

## 🔍 问题原因

**备考表和封面导出为空的原因**：Word模板文件中缺少占位符

- 代码逻辑是正确的 ✅
- 数据已经生成 ✅
- 但是模板文件是空白的，所以导出也是空白的 ❌

**解决方法**：在模板文件中添加占位符

---

## ⚡ 快速解决方案（5分钟）

### 第一步：使用调试工具检查数据

1. 启动应用：`./run.sh`
2. 点击页面右下角的 **"🔍 调试"** 按钮
3. 在调试面板中点击 **"⚡ 自动生成所有数据"**
4. 确认数据已生成（会显示具体数值）

### 第二步：编辑模板文件

#### 📋 编辑"表四、卷内备考表.docx"

1. 打开文件：`templates/表四、卷内备考表.docx`

2. 将以下内容复制粘贴到Word文档中：

```
卷内备考表

本案卷共有文件材料    {{totalPages}}    页
其中：文字材料        {{textPages}}    页
      图样材料        {{drawingPages}}    页
      照片            {{photoCount}}    张

说明：{{note}}

立卷人：{{creator}}    日期：{{createDate}}
审核人：{{reviewer}}    日期：{{reviewDate}}
```

3. 保存文件

#### 📕 编辑"表二、档案封面.docx"

1. 打开文件：`templates/表二、档案封面.docx`

2. 将以下内容复制粘贴到Word文档中：

```
案卷封面

档号：{{archiveNo}}

案卷题名：{{title}}

编制单位：{{unit}}

起止日期：{{startDate}} 至 {{endDate}}

密级：{{secretLevel}}

保管期限：{{retentionPeriod}}

本工程共 {{totalVolumes}} 卷

本案卷为第 {{volumeNumber}} 卷
```

3. 保存文件

### 第三步：重新导出Word文档

1. 在网页中点击 **"导出Word"** 按钮
2. 选择要导出的文档类型
3. 查看导出的文件，数据应该已经填充了！

---

## 🎨 自定义模板样式（可选）

如果您想自定义模板的样式（字体、颜色、边框等）：

1. 打开模板Word文件
2. 保留占位符（如 `{{totalPages}}`）
3. 修改字体、字号、颜色、表格样式等
4. 保存文件
5. 导出时会完整保留您的样式

### 占位符说明

**占位符格式**：`{{字段名}}`

**重要**：
- 必须包含双花括号 `{{}}`
- 字段名必须完全匹配（区分大小写）
- 可以在任何位置使用占位符

**示例**：
```
正确：{{totalPages}}
错误：{totalPages}
错误：{{TotalPages}}
错误：{{ totalPages }}（有空格）
```

---

## 📖 完整占位符列表

### 卷内备考表（表四）

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `{{totalPages}}` | 总页数 | 150 |
| `{{textPages}}` | 文字材料页数 | 120 |
| `{{drawingPages}}` | 图样材料页数 | 28 |
| `{{photoCount}}` | 照片张数 | 2 |
| `{{note}}` | 说明 | 本工程档案已整理完毕 |
| `{{creator}}` | 立卷人 | 张三 |
| `{{createDate}}` | 立卷日期 | 2024-11-16 |
| `{{reviewer}}` | 审核人 | 李四 |
| `{{reviewDate}}` | 审核日期 | 2024-11-17 |

### 案卷封面（表二）

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `{{archiveNo}}` | 档号 | 2024-001 |
| `{{title}}` | 案卷题名 | 某某工程施工文件 |
| `{{unit}}` | 编制单位 | 某某建设公司 |
| `{{startDate}}` | 起始日期 | 2024-01-01 |
| `{{endDate}}` | 结束日期 | 2024-11-16 |
| `{{secretLevel}}` | 密级 | 无 |
| `{{retentionPeriod}}` | 保管期限 | 永久 |
| `{{totalVolumes}}` | 本工程共几卷 | 3 |
| `{{volumeNumber}}` | 本案卷为第几卷 | 1 |

### 档案移交书（附件3）

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `{{title}}` | 工程名称 | 某某工程 |
| `{{unit}}` | 移交单位 | 某某建设公司 |
| `{{date}}` | 移交日期 | 2024-11-16 |
| `{{totalVolumes}}` | 案卷数量 | 3 |
| `{{totalPages}}` | 文件总页数 | 450 |
| `{{note}}` | 移交说明 | 已按标准整理 |
| `{{archiveNo}}` | 档号 | 2024-001 |
| `{{retentionPeriod}}` | 保管期限 | 永久 |

---

## 🔧 使用调试工具

### 打开调试面板

1. 点击页面右下角的 **"🔍 调试"** 按钮
2. 调试面板会显示在页面右上角

### 调试面板功能

#### 📊 数据状态
- 查看当前所有数据是否已生成
- 红色标记表示数据缺失

#### 📄 模板状态
- 提示哪些模板需要配置
- 查看模板配置指南

#### 🔧 快速操作
- **⚡ 自动生成所有数据**：一键生成备考表、封面、案卷目录数据
- **💾 导出数据JSON**：备份当前所有数据
- **🗄️ 查看存储数据**：查看LocalStorage中的数据
- **🧪 测试导出功能**：检查数据完整性

---

## ❓ 常见问题

### Q1: 我添加了占位符，但导出还是空白？

**可能原因**：
1. 占位符格式不正确（检查花括号、大小写）
2. 数据没有生成（点击"自动生成所有数据"）
3. 保存模板后没有刷新浏览器

**解决方法**：
1. 使用调试工具的"🧪 测试导出功能"检查数据
2. 确认占位符格式完全正确
3. 保存模板后，刷新网页（F5）

### Q2: 可以只填充部分字段吗？

**可以！**

- 只需在模板中添加您需要的占位符
- 不需要的字段可以不添加占位符
- 空字段会显示为空白

**示例**（简化版备考表）：
```
本案卷共有文件材料 {{totalPages}} 页
立卷人：{{creator}}
```

### Q3: 模板文件在哪里？

**路径**：`templates/` 目录

**文件列表**：
- `表三、卷内目录.docx` - ✅ 无需配置（自动填充）
- `表四、卷内备考表.docx` - ⚠️ 需要添加占位符
- `表二、档案封面.docx` - ⚠️ 需要添加占位符
- `表一、档案移交目录.docx` - ✅ 无需配置（自动填充）
- `附件3-移交书.docx` - ⚠️ 需要添加占位符

### Q4: 数据从哪里来？

**数据来源**：
1. **卷内目录**：您手动填写的数据
2. **备考表**：从卷内目录自动计算
3. **封面**：从卷内目录自动提取
4. **案卷目录**：从当前卷数据汇总

**生成方法**：
- 点击"自动生成其他表格"按钮
- 或使用调试工具的"⚡ 自动生成所有数据"

---

## 📝 完整操作流程

### 推荐工作流程

```
1. 启动应用
   └─> ./run.sh

2. 打开调试面板
   └─> 点击右下角"🔍 调试"

3. 填写卷内目录
   └─> 手动输入或粘贴数据

4. 生成其他表格数据
   └─> 点击"⚡ 自动生成所有数据"
   └─> 或点击"自动生成其他表格"按钮

5. 检查数据
   └─> 在调试面板查看数据状态
   └─> 确认所有数据都已生成

6. 编辑模板（首次使用）
   └─> 打开模板文件
   └─> 添加占位符
   └─> 保存

7. 导出Word文档
   └─> 点击"导出Word"
   └─> 选择要导出的类型
   └─> 查看导出的文件

8. 检查导出结果
   └─> 打开导出的Word文件
   └─> 确认数据已正确填充
```

---

## 🎯 5分钟快速完成

如果您想最快速度完成，按照这个流程：

```bash
# 1. 启动（自动打开浏览器）
./run.sh

# 2. 在浏览器中操作：
#    - 点击右下角"🔍 调试"
#    - 点击"⚡ 自动生成所有数据"
#    - 点击"📖 查看模板配置指南"
#    - 按照指南编辑模板文件

# 3. 编辑模板（复制粘贴上面的模板内容）
#    - templates/表四、卷内备考表.docx
#    - templates/表二、档案封面.docx

# 4. 导出Word
#    - 点击"导出Word" → 选择类型 → 完成！
```

---

## 📚 相关文档

- **模板占位符详细说明**：`templates/模板占位符说明.md`
- **多卷管理设计方案**：`多卷管理系统设计方案.md`
- **完整使用文档**：`README.md`
- **快速开始**：`快速开始.md`

---

## 💡 提示

1. **备份数据**：定期导出Excel和Word文档
2. **自定义模板**：可以自由调整模板样式，只要保留占位符
3. **使用调试工具**：遇到问题先打开调试面板检查
4. **保存模板**：每次修改模板后要保存文件

---

**现在就试试**：启动应用，点击调试按钮，查看数据状态！

需要帮助？查看 `templates/模板占位符说明.md` 或打开调试面板。
