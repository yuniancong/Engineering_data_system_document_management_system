# 端口占用问题解决方案

## 问题描述

运行 `./run.sh` 时出现错误：
```
OSError: [Errno 48] Address already in use
```

这表示默认端口（8000）已被其他程序占用。

## 解决方案

### 方案一：使用更新后的启动脚本（推荐）✨

最新版本的 `run.sh` 已经支持**自动检测端口占用并切换到可用端口**。

**使用方法**：
```bash
./run.sh
```

脚本会自动：
1. 检测8000端口是否被占用
2. 如果被占用，自动查找8001-8009之间的可用端口
3. 在找到的可用端口上启动服务器
4. 在浏览器中打开正确的地址

**输出示例**：
```
🔍 检查端口可用性...
⚠️  端口 8000 已被占用
🔄 正在查找可用端口...
✓ 找到可用端口: 8001

✅ 使用 Python 3 启动服务器
📡 服务器地址: http://localhost:8001
🌐 浏览器将自动打开...
```

### 方案二：手动指定端口

如果您想使用特定端口，可以这样：

```bash
# 使用9000端口
PORT=9000 ./run.sh
```

或者修改脚本中的默认端口：
```bash
# 编辑 run.sh 文件
# 将 DEFAULT_PORT=8000 改为 DEFAULT_PORT=9000
```

### 方案三：查找并终止占用端口的进程

#### 1. 使用辅助脚本（推荐）

项目提供了端口管理辅助脚本：

```bash
# 检查8000端口
./check-port.sh 8000

# 检查并显示可用端口
./check-port.sh 8000 -a
```

该脚本会：
- 显示占用端口的进程信息
- 询问是否终止该进程
- 自动处理进程终止

#### 2. 手动查找和终止进程

**macOS/Linux**：

```bash
# 查找占用8000端口的进程
lsof -i :8000

# 终止进程（替换PID为实际的进程ID）
kill <PID>

# 如果无法终止，使用强制终止
kill -9 <PID>
```

**一行命令直接终止**：
```bash
# 谨慎使用！这会直接终止占用8000端口的进程
lsof -ti :8000 | xargs kill -9
```

**macOS替代方法**：
```bash
# 使用netstat查找
netstat -an | grep :8000 | grep LISTEN
```

#### 3. 查找所有Python HTTP服务器并终止

如果您之前启动过其他HTTP服务器：

```bash
# 查找所有Python HTTP服务器
ps aux | grep "http.server"

# 终止所有Python HTTP服务器
pkill -f "http.server"
```

### 方案四：重启终端

有时候进程可能在后台运行，最简单的方法：

1. 关闭所有终端窗口
2. 重新打开终端
3. 运行 `./run.sh`

## 常见原因

### 1. 之前的服务器没有正确关闭

**症状**：之前运行过启动脚本，但没有按 `Ctrl+C` 正确停止

**解决**：
```bash
# 终止所有http.server进程
pkill -f "http.server"
```

### 2. 其他应用占用了8000端口

**常见占用8000端口的应用**：
- 其他开发服务器（Django, Flask等）
- 数据库管理工具
- API测试工具
- Docker容器

**解决**：
- 关闭这些应用
- 或使用方案一让脚本自动切换端口

### 3. 多个终端窗口同时运行

**症状**：在多个终端窗口中都尝试启动服务器

**解决**：
- 只在一个终端窗口中运行启动脚本
- 关闭其他终端窗口中的服务器（按 `Ctrl+C`）

## 验证端口是否可用

在启动前，可以先检查端口：

```bash
# 检查8000端口
./check-port.sh 8000

# 或手动检查
lsof -i :8000
```

如果没有输出，说明端口可用。

## 推荐工作流程

1. **首选**：直接运行 `./run.sh`，让脚本自动处理端口问题
2. **备选**：如果需要，先用 `./check-port.sh 8000` 检查和清理端口
3. **最后手段**：手动查找和终止进程

## 脚本功能对比

| 脚本 | 功能 | 端口处理 |
|------|------|----------|
| `run.sh` | 一键启动 | ✅ 自动检测并切换端口 |
| `start-server.sh` | 基础启动 | ❌ 端口被占用会报错 |
| `check-port.sh` | 端口管理 | ✅ 检查和终止占用进程 |

## 更多帮助

如果以上方案都无法解决问题：

1. 检查系统防火墙设置
2. 尝试使用其他端口范围（如 `PORT=3000 ./run.sh`）
3. 查看系统日志了解详细错误信息
4. 重启电脑（最后手段）

---

**提示**：最新版本的启动脚本已经内置了智能端口管理，大多数情况下您不需要手动处理端口问题！
